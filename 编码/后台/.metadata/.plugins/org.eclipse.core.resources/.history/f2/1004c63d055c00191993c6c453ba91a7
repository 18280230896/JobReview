package com.llg.util;

import java.io.File;
import java.util.HashMap;
import java.util.Map;

import javax.tools.DiagnosticCollector;
import javax.tools.JavaCompiler;
import javax.tools.JavaFileObject;
import javax.tools.StandardJavaFileManager;
import javax.tools.ToolProvider;

public class Compiler {

	public static Map<String, Object> compiler(File[] files){
		Map<String, Object> result = new HashMap<>();
		JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
		StandardJavaFileManager fileManager = compiler.getStandardFileManager(null, null, null);
		Iterable<? extends JavaFileObject> javaFileObjects = fileManager.getJavaFileObjects(files);
		DiagnosticCollector<JavaFileObject> diagnostics = new DiagnosticCollector<JavaFileObject>();
		boolean success = compiler.getTask(null, fileManager, diagnostics, null, null, javaFileObjects).call();
		result.put("success", success);
		if(!success){
			result.put("msg", diagnostics.getDiagnostics());
			return result;
		}
		return result;
	}
}
