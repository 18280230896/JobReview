var task;
var taskId = $("#taskId").val();
//初始任务基本信息
taskInfoInit();
//初始任务基本信息
function taskInfoInit(){
	//获取数据
	$.ajax({
		url:"teacherGetTaskInfo.action",
		type:"post",
		data:{"taskId":taskId},
		dataType:"json",
		success:function(result){
			task = result.task;
			//将任务信息展示到界面
			//基本信息
			$("#taskInfo li:eq(0) span:eq(1)").text(task.name);
			if(task.type === 1) $("#taskInfo li:eq(1) span:eq(1)").text("Java 任务");
			else $("#taskInfo li:eq(1) span:eq(1)").text("Oracle 任务");
			
			//模块列表
			//先清空，在生成
			$("#moduleList .ul-info").empty();
			for(var i=0;i<task.subjects.length;i++){
				if(task.subjects[i].id == null) continue;
				var newli = $("<li class='subjects'>"+
							"<input type='hidden' value='"+task.subjects[i].id+"' />"+
							"<span>"+(i+1)+"、"+task.subjects[i].name+"</span>"+
							" <span class='glyphicon glyphicon-pencil option update'></span>"+
							" <span class='glyphicon glyphicon-remove option delete'></span>"+
						"</li>")
				$("#moduleList .ul-info").append(newli);
			}
			if(task.subjects.length == 0 || task.subjects[0].id == null){
				var newli = $("<li>"+
						"<span>还没有题目哦!</span>"+
					"</li>")
			$("#moduleList .ul-info").append(newli);
			}
		}
	});
}

$("#updateModal .btn-primary").click(function(){
	var flag = $("#updateModal .modal-footer input:eq(0)").val();
	if (flag == 1 || flag == 2){
		var key;
		flag == 1 ? key = "name" : key = "type";
		var value;
		flag == 1 ? value = $("#updateModal input:eq(0)").val : value = $("#updateModal option:selected").val;
		$.ajax({
			url:"teacherUpdateTaskInfo.action",
			type:"post",
			dataType:"json",
			data:{"id":task.id,key:value},
			success:function(result){
				if(result.msg == 1){
					$("#updateModal").modal("hide");
					tips("success","修改成功！")
				}
			}
		});
	}
});
